#!/usr/bin/env python

from Crypto.Cipher import AES
import binascii
import struct

hex_key = "fbcfc121915d99cc20a3d3d5d84f8308"
key = binascii.unhexlify(hex_key)

with open("../../artifacts/obj9/alabaster_passwords.elfdb.wannacookie", 'rb') as f:
    # $FileSW.Write([System.BitConverter]::GetBytes($AESP.IV.Length), 0, 4)
    iv_length = struct.unpack('i', f.read(4))[0]

    # $FileSW.Write($AESP.IV, 0, $AESP.IV.Length)
    iv = f.read(iv_length)

    rest = f.read()

    obj = AES.new(key, AES.MODE_CBC, iv)

    result = open("../../artifacts/obj9/alabaster_passwords.elfdb", 'wb')
    result.write(obj.decrypt(rest))
    result.close()

